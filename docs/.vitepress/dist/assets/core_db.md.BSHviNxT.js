import{_ as i,c as a,o as n,ag as t}from"./chunks/framework.dvv-DFtf.js";const c=JSON.parse('{"title":"ğŸ—„ï¸ Goryu DB Package","description":"","frontmatter":{},"headers":[],"relativePath":"core/db.md","filePath":"core/db.md","lastUpdated":null}'),e={name:"core/db.md"};function l(h,s,p,r,o,k){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="ğŸ—„ï¸-goryu-db-package" tabindex="-1">ğŸ—„ï¸ Goryu DB Package <a class="header-anchor" href="#ğŸ—„ï¸-goryu-db-package" aria-label="Permalink to &quot;ğŸ—„ï¸ Goryu DB Package&quot;">â€‹</a></h1><blockquote><p><strong>Secure, robust, and driver-agnostic database connections.</strong></p></blockquote><p>The <code>db</code> package provides a unified way to connect to various databases while enforcing strict security policies. It handles connection pooling, DSN construction, and security validation automatically.</p><hr><h2 id="âœ¨-key-features" tabindex="-1">âœ¨ Key Features <a class="header-anchor" href="#âœ¨-key-features" aria-label="Permalink to &quot;âœ¨ Key Features&quot;">â€‹</a></h2><ul><li><strong>ğŸ›¡ï¸ Secure by Default</strong>: <ul><li><strong>Anti-Injection</strong>: Validates all connection parameters against SQL injection patterns.</li><li><strong>Path Protection</strong>: Prevents directory traversal attacks for SQLite databases.</li><li><strong>Sanitization</strong>: Automatically URL-encodes credentials and parameters.</li></ul></li><li><strong>ğŸ”Œ Multi-Driver Support</strong>: First-class support for PostgreSQL, MySQL, and SQLite3.</li><li><strong>ğŸŠ Connection Pooling</strong>: Built-in configuration for <code>MaxOpenConns</code>, <code>MaxIdleConns</code>, and connection lifetimes.</li><li><strong>âœ… Auto-Validation</strong>: Pings the database immediately upon connection to ensure reachability.</li></ul><hr><h2 id="ğŸš€-usage" tabindex="-1">ğŸš€ Usage <a class="header-anchor" href="#ğŸš€-usage" aria-label="Permalink to &quot;ğŸš€ Usage&quot;">â€‹</a></h2><h3 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">â€‹</a></h3><p>Configure your database in your application&#39;s config.</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/arthurlch/goryu/config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Database: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DatabaseConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Driver:          </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;postgres&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// or &quot;mysql&quot;, &quot;sqlite3&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Host:            </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;localhost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Port:            </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5432</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Database:        </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;myapp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Username:        </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Password:        </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;secret&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SSLMode:         </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;disable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Connection Pool Settings</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        MaxOpenConns:    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        MaxIdleConns:    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ConnMaxLifetime: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.Minute,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="connecting" tabindex="-1">Connecting <a class="header-anchor" href="#connecting" aria-label="Permalink to &quot;Connecting&quot;">â€‹</a></h3><p>Use <code>db.Connect</code> to establish a secure connection.</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/arthurlch/goryu/db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... load config ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conn, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Fatalf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Could not connect to database: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    defer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> conn.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Access the underlying *sql.DB</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // conn.DB.Query(...)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Successfully connected to&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, conn.Driver)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="ğŸ”’-security-details" tabindex="-1">ğŸ”’ Security Details <a class="header-anchor" href="#ğŸ”’-security-details" aria-label="Permalink to &quot;ğŸ”’ Security Details&quot;">â€‹</a></h2><p>The <code>db</code> package implements several layers of security checks before even attempting a connection:</p><h3 id="sql-injection-prevention" tabindex="-1">SQL Injection Prevention <a class="header-anchor" href="#sql-injection-prevention" aria-label="Permalink to &quot;SQL Injection Prevention&quot;">â€‹</a></h3><p>All inputs (username, password, database name, etc.) are scanned for dangerous characters (e.g., <code>;</code>, <code>--</code>, <code>/*</code>) that could be used for injection attacks in the connection string.</p><h3 id="sqlite-path-traversal" tabindex="-1">SQLite Path Traversal <a class="header-anchor" href="#sqlite-path-traversal" aria-label="Permalink to &quot;SQLite Path Traversal&quot;">â€‹</a></h3><p>If you use SQLite, the path is rigorously checked to prevent:</p><ul><li>Directory traversal (<code>../../etc/passwd</code>)</li><li>Access to system directories (<code>/etc/</code>, <code>/var/</code>)</li><li>Hidden file access (optional based on config)</li></ul><h3 id="parameter-sanitization" tabindex="-1">Parameter Sanitization <a class="header-anchor" href="#parameter-sanitization" aria-label="Permalink to &quot;Parameter Sanitization&quot;">â€‹</a></h3><p>All parameters are URL-encoded when building the Data Source Name (DSN) to prevent parameter injection attacks.</p><hr><h2 id="ğŸ“¦-supported-drivers" tabindex="-1">ğŸ“¦ Supported Drivers <a class="header-anchor" href="#ğŸ“¦-supported-drivers" aria-label="Permalink to &quot;ğŸ“¦ Supported Drivers&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>Driver</th><th>Config Key</th><th>Notes</th></tr></thead><tbody><tr><td><strong>PostgreSQL</strong></td><td><code>postgres</code> / <code>pgx</code></td><td>Supports SSL modes (<code>disable</code>, <code>require</code>, <code>verify-full</code>).</td></tr><tr><td><strong>MySQL</strong></td><td><code>mysql</code></td><td>Supports charsets (default <code>utf8mb4</code>).</td></tr><tr><td><strong>SQLite3</strong></td><td><code>sqlite3</code></td><td>In-memory support via <code>:memory:</code>.</td></tr></tbody></table>`,27)])])}const E=i(e,[["render",l]]);export{c as __pageData,E as default};

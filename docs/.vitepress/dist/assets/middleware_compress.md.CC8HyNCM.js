import{_ as e,c as i,o as a,ag as t}from"./chunks/framework.dvv-DFtf.js";const k=JSON.parse('{"title":"Compress Middleware","description":"","frontmatter":{},"headers":[],"relativePath":"middleware/compress.md","filePath":"middleware/compress.md","lastUpdated":1767467382000}'),n={name:"middleware/compress.md"};function l(o,s,r,p,h,d){return a(),i("div",null,[...s[0]||(s[0]=[t(`<h1 id="compress-middleware" tabindex="-1">Compress Middleware <a class="header-anchor" href="#compress-middleware" aria-label="Permalink to &quot;Compress Middleware&quot;">​</a></h1><p>A middleware that compresses HTTP responses using Gzip or Deflate. It automatically negotiates the best encoding based on the client&#39;s <code>Accept-Encoding</code> header.</p><h2 id="features" tabindex="-1">Features <a class="header-anchor" href="#features" aria-label="Permalink to &quot;Features&quot;">​</a></h2><ul><li><strong>Multiple Algorithms</strong>: Supports <code>gzip</code> and <code>deflate</code>.</li><li><strong>Content Filtering</strong>: Only compresses specific content types (e.g., HTML, JSON, XML).</li><li><strong>Size Threshold</strong>: Skips compression for small responses (configurable <code>MinLength</code>) to avoid overhead.</li><li><strong>Configurable Levels</strong>: Adjust compression level (BestSpeed vs BestCompression).</li></ul><h2 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;Usage&quot;">​</a></h2><h3 id="basic-setup" tabindex="-1">Basic Setup <a class="header-anchor" href="#basic-setup" aria-label="Permalink to &quot;Basic Setup&quot;">​</a></h3><p>Enable compression with default settings (Gzip/Deflate, default level):</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(compress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><h3 id="gzip-only" tabindex="-1">Gzip Only <a class="header-anchor" href="#gzip-only" aria-label="Permalink to &quot;Gzip Only&quot;">​</a></h3><p>Force Gzip compression:</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(compress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(compress.LevelBestCompression))</span></span></code></pre></div><h3 id="advanced-configuration" tabindex="-1">Advanced Configuration <a class="header-anchor" href="#advanced-configuration" aria-label="Permalink to &quot;Advanced Configuration&quot;">​</a></h3><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(compress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Level:     compress.LevelBestSpeed, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prioritize speed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    MinLength: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2048</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Only compress if &gt; 2KB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CompressibleTypes: []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;text/html&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;image/svg+xml&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}))</span></span></code></pre></div><h2 id="how-it-works" tabindex="-1">How It Works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How It Works&quot;">​</a></h2><ol><li><strong>Negotiation</strong>: Checks the <code>Accept-Encoding</code> header.</li><li><strong>Buffering</strong>: Buffers the response to determine its size.</li><li><strong>Filtering</strong>: Checks if the <code>Content-Type</code> is in the allowed list and if the size exceeds <code>MinLength</code>.</li><li><strong>Compression</strong>: If criteria are met, compresses the body and sets <code>Content-Encoding</code>. Otherwise, sends the original response.</li></ol><h2 id="performance-note" tabindex="-1">Performance Note <a class="header-anchor" href="#performance-note" aria-label="Permalink to &quot;Performance Note&quot;">​</a></h2><p>Compression consumes CPU. While it reduces bandwidth usage and improves client load times, be mindful of the CPU overhead on high-traffic servers. <code>LevelBestSpeed</code> is often a good trade-off.</p>`,17)])])}const g=e(n,[["render",l]]);export{k as __pageData,g as default};
